---
title: "Homework 7"
author: "Jeff Nguyen"
date: "09/12/2020"
output:
  html_document: default
  pdf_document:
    extra_dependencies: ["dsfont"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, envir=.GlobalEnv)
```

**Pre-MFE Probability Seminar**  
**Baruch College, Fall 2020**  


Homework 07  
Student Name: Ngoc Son (Jeff) Nguyen  


# **Question 1**  

Consider the random variable $X_1, X_2, ..., X_{10000}$ as the annual payout to customer's insurance claim.  

We are given $E[X_i] = \mu = 10^3$ and $Var[X_i] = 8*10^2$.  

We are looking to find the average charge to each customer denoting $\Pi$ so that the probability of the event that the sum of annual payout to each customer not exceeding the total annual charge for each customer is exactly $99.5\%$, i.e.:  

\begin{equation}
  \begin{aligned}
    \mathds{P}\Big[ X_1 + ... + X_{10000} \leqslant 10^4\Pi \Big] =& .995 \\
    \mathds{P}\Big[ X_1 + ... + X_{10000} - 10^4\mu \leqslant 10^4\Pi - 10^4\mu \Big] =& .995 \\
    \mathds{P}\Big[ \frac{X_1 + ... + X_{10000} - 10^4*10^3}{\sqrt{10^4}\sqrt{8*10^2}} \leqslant \frac{10^4\Pi - 10^4*10^3}{\sqrt{10^4}\sqrt{8*10^2}} \Big] =& .995 \\
    \mathds{P}\Big[ \frac{X_1 + ... + X_{10000} - 10^4*10^3}{10^3*2\sqrt{2}} \leqslant \frac{10^4(\Pi -10^3)}{10^3*2\sqrt{2}} \Big] =& .995 \\
    \mathds{P}\Big[ \frac{X_1 + ... + X_{10000} - 10^4*10^3}{10^3*2\sqrt{2}} \leqslant \frac{5(\Pi -10^3)}{\sqrt{2}} \Big] =& .995 \\
    N\Big[ \frac{5(\Pi -10^3)}{\sqrt{2}} \Big] =& .995  \quad \text{(Central Limit Theorem)}  \\
    \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\frac{5(\Pi -10^3)}{\sqrt{2}}} e^{-\frac{t^2}{2}}dt =& .995  \\
    \frac{1}{\sqrt{2\pi}} \frac{\sqrt{\pi}}{\sqrt{2}}erf\Big( \frac{t}{\sqrt{2}} \Big) \Big|_{t=-\infty}^{t={\frac{5(\Pi -10^3)}{\sqrt{2}}}} =& .995  \\
    \frac{1}{2}erf\Big[ \frac{5(\Pi -10^3)}{2} \Big] + \frac{1}{2} =& .995  \\
    erf\Big[ \frac{5(\Pi -10^3)}{2} \Big] =& .99  \\
    \frac{5(\Pi -10^3)}{2} =& erf^{-1}(.99)  \\
    \Pi =& \frac{2erf^{-1}(.99) + 10^3}{5}  \\
  \end{aligned}
\end{equation}

```{r}
library(pracma)
Pi <- (2*erfinv(.99)+10^3)/5
```

Using R to approximate, we have the necessary average annual charge to each customer to be $\Pi = \frac{2erf^{-1}(.99) + 10^3}{5} \approx `r Pi`$, or approximately $\$ `r round(Pi,2)`$.  

# **Question 2**  

X, Y are bivariate normal random variables, following $X \sim N(\mu_X, \sigma_X^2)$, $Y \sim N(\mu_Y, \sigma_Y^2)$ and $\rho(X,Y) = \rho$.  


By definition, their joint pdf is given by:  

\begin{equation}
  \begin{aligned}
    f_{XY} = \frac{1}{2 \pi \sigma_X \sigma_Y \sqrt{1-\rho^2}} * e^{-{\frac{1}{2(1-\rho^2)}}*{\Big[ \Big( \frac{x-\mu_X}{\sigma_X} \Big)^2 + \Big( \frac{y-\mu_Y}{\sigma_Y} \Big)^2 - 2\rho\frac{(x-\mu_X)(y-\mu_Y)}{\sigma_X\sigma_Y}  \Big]}}
  \end{aligned}
\end{equation}
  
There exists $Z_1$ and $Z_2$ random variable such that $Z_1 \sim N(0,1)$ and $Z_2 \sim N(0,1)$ such that:

\begin{equation}
  \begin{aligned}
    \left\{
      \begin{matrix}
        X =& \sigma_X(\rho Z_1 + \sqrt{1 - \rho^2}Z_2) + \mu_X  \\
        Y =& \sigma_Y Z_1 + \mu_Y  \\
      \end{matrix}
    \right.
  \end{aligned}
\end{equation}

Thus, given $Y=y$, we have:  

\begin{equation}
  \begin{aligned}
    y =& \sigma_Y Z_1 + \mu_Y  \\
    Z_1 =& \frac{y - \mu_Y}{\sigma_Y}
  \end{aligned}
\end{equation}

In addition:

\begin{equation}
  \begin{aligned}
    X =& \sigma_X(\rho Z_1 + \sqrt{1 - \rho^2}Z_2) + \mu_X  \\
      =& \sigma_X(\rho \frac{y - \mu_Y}{\sigma_Y} + \sqrt{1 - \rho^2}Z_2) + \mu_X  \\
      =& \sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} + \sigma_X \sqrt{1 - \rho^2}Z_2 + \mu_X  \\
  \end{aligned}
\end{equation}

Since $Z_1$ and $Z_2$ are independent, given $Y=y$, we can see $X$ is a linear function of $Z_2$, thus:

\begin{equation}
  \begin{aligned}
    \mathds{E}[X \Big| Y=y] =& \mathds{E} \Big[ {\sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} + \sigma_X \sqrt{1 - \rho^2}Z_2 + \mu_X} \Big| Y=y \Big]  \\
                      =& \mathds{E} \Big[ \sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} \Big| Y=y \Big] + \mathds{E} \Big[ \sigma_X \sqrt{1 - \rho^2}Z_2 \Big| Y=y \Big] + \mathds{E} [\mu_X \Big| Y=y ]  \\
                      =& \sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} + \sigma_X \sqrt{1 - \rho^2} \mathds{E}[Z_2] + \mu_X  \\
                      =& \sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} + \sigma_X \sqrt{1 - \rho^2} * 0 + \mu_X  \\
                      =& \sigma_X \sigma_Y \rho \frac{y - \mu_Y}{\sigma_Y^2} + \mu_X  \\
                      =& \frac{Cov(X,Y)(y - \mu_Y)}{Var[Y]} + \mathds{E}[X]  \\
                      =& \mathds{E}[X] + \frac{Cov(X,Y)(y - \mathds{E}[Y])}{Var[Y]}  \\
                      =& \mathds{E}[X] + \frac{Cov(X,Y)}{Var[Y]}(y - \mathds{E}[Y])  \quad \text{(Q.E.D)}  \\
  \end{aligned}
\end{equation}
  
In addition:  

\begin{equation}
  \begin{aligned}
    Var[X \Big| Y = y] =& Var \Big[ \sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} + \sigma_X \sqrt{1 - \rho^2}Z_2 + \mu_X \Big| Y=y \Big]  \\
                       =& Var \Big[ \sigma_X \rho \frac{y - \mu_Y}{\sigma_Y} \Big| Y=y \Big ] + Var \Big[ \sigma_X \sqrt{1 - \rho^2}Z_2 \Big| Y=y \Big] + Var \Big[ \mu_X \Big| Y=y \Big]  \\
                       =& 0 + \sigma_X^2(1 - \rho^2) Var[Z_2] + 0  \\
                       =& \sigma_X^2(1 - \rho^2) * 1  \\
                       =& (1 - \rho^2)Var[X]  \quad \text{(Q.E.D)}  \\
  \end{aligned}
\end{equation}
  
  
# **Question 3**    

We have the parameters: $r=0, \, S_0 = 8, \, \mu=2, \, \sigma=2, \, K=8e^{18}, \, t=9$.  

Thus:  

\begin{equation}
  \begin{aligned}
    d_+ =& \frac{{ln\frac{S_0}{K}} + {\Big( r + \frac{\sigma^2}{2} \Big)}t}{\sigma \sqrt{t}}  \\
        =& \frac{{ln\frac{8}{8e^{18}}} + {\Big( 0 + \frac{2^2}{2} \Big)}9}{2 \sqrt{9}}  \\
        =& \frac{{ln\frac{1}{e^{18}}} + 18}{6}  \\
        =& \frac{ln{e^{-18}} + 18}{6}  \\
        =& \frac{-18 + 18}{6}  \\
        =& 0 \\
  \end{aligned}
\end{equation}

and  

\begin{equation}
  \begin{aligned}
    d_- =& \frac{{ln\frac{S_0}{K}} + {\Big( r - \frac{\sigma^2}{2} \Big)}t}{\sigma \sqrt{t}}  \\
        =& \frac{{ln\frac{8}{8e^{18}}} + {\Big( 0 - \frac{2^2}{2} \Big)}9}{2 \sqrt{9}}  \\
        =& \frac{{ln\frac{1}{e^{18}}} - 18}{6}  \\
        =& \frac{ln{e^{-18}} - 18}{6}  \\
        =& \frac{-18 - 18}{6}  \\
        =& \frac{-16}{3}  \\
  \end{aligned}
\end{equation}


## Price at time 0 of European call option  

We have the Black-Scholes formula for the price at time 0 of European call option:  

\begin{equation}
  \begin{aligned}
    C_0 =& S_0 \Phi(d_+) - K e^{-rt} \Phi(d_-)  \\
        =& 8 \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{0} e^{-\frac{z^2}{2}}dz - 
           8e^{18} e^{-0*9} \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\frac{-16}{3}} e^{-\frac{z^2}{2}}dz  \\
        =& \frac{4\sqrt{2}}{\sqrt{\pi}} \int_{-\infty}^{0} e^{-\frac{z^2}{2}}dz - 
           8e^{18} \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\frac{-16}{3}} e^{-\frac{z^2}{2}}dz  \\
        =& \frac{4\sqrt{2}}{\sqrt{\pi}} \frac{\sqrt{\pi}erf\Big( \frac{z}{\sqrt{2}} \Big)}{\sqrt{2}} \Big|_{z=-\infty}^{z=0} - 
           \frac{4\sqrt{2}e^{18}}{\sqrt{\pi}} \frac{\sqrt{\pi}erf\Big( \frac{z}{\sqrt{2}} \Big)}{\sqrt{2}} \Big|_{z=-\infty}^{z=\frac{-16}{3}}  \\
        =& 4 erf\Big( \frac{z}{\sqrt{2}} \Big) \Big|_{z=-\infty}^{z=0} - 
           4e^{18} erf\Big( \frac{z}{\sqrt{2}} \Big) \Big|_{z=-\infty}^{z=\frac{-16}{3}}  \\
        =& 4 erf\Big( \frac{0}{\sqrt{2}} \Big) - 4 erf\Big( \frac{-\infty}{\sqrt{2}} \Big) - 
           4e^{18} erf\Big( \frac{\frac{-16}{3}}{\sqrt{2}} \Big) + 4e^{18} erf\Big( \frac{-\infty}{\sqrt{2}} \Big)  \\
        =& 4 erf(0) - 4 erf(-\infty) - 4e^{18} erf\Big( -\frac{8\sqrt{2}}{3} \Big) + 4e^{18} erf(-\infty)  \\
        =& 4*0 - 4*(-1) - 4e^{18} erf\Big( -\frac{8\sqrt{2}}{3} \Big) - 4e^{18}*(-1)  \\
        =& 4 - 4e^{18} erf\Big( -\frac{8\sqrt{2}}{3} \Big) + 4e^{18}  \\
        =& 4\Big( 1 - e^{18} \Big[ erf(-\frac{8\sqrt{2}}{3}) + 1 \Big] \Big)  \\
  \end{aligned}
\end{equation}

```{r}
C_0 <- 4 * (1 - exp(18)* (erf(-8*sqrt(2)/3) - 1))
```

Thus, $C_0 = 4\Big( 1 - e^{18} \Big[ erf(-\frac{8\sqrt{2}}{3}) + 1 \Big] \Big) \approx `r C_0`$.
  
## Price at time 0 of European put option  

We have the Black-Scholes formula for the price at time 0 of European put option:  

\begin{equation}
  \begin{aligned}
    P_0 =& K e^{-rt} \Phi(-d_-) - S_0 \Phi(-d_+)  \\
        =& 8e^{18} e^{-0*9} \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\frac{16}{3}} e^{-\frac{z^2}{2}}dz - 
           8 \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{0} e^{-\frac{z^2}{2}}dz  \\
        =& 8e^{18} \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\frac{16}{3}} e^{-\frac{z^2}{2}}dz - 
           \frac{4\sqrt{2}}{\sqrt{\pi}} \int_{-\infty}^{0} e^{-\frac{z^2}{2}}dz  \\
        =& \frac{4\sqrt{2}e^{18}}{\sqrt{\pi}} \frac{\sqrt{\pi}erf\Big( \frac{z}{\sqrt{2}} \Big)}{\sqrt{2}} \Big|_{z=-\infty}^{z=\frac{16}{3}} -  
           \frac{4\sqrt{2}}{\sqrt{\pi}} \frac{\sqrt{\pi}erf\Big( \frac{z}{\sqrt{2}} \Big)}{\sqrt{2}} \Big|_{z=-\infty}^{z=0} \\
        =& 4e^{18} erf\Big( \frac{z}{\sqrt{2}} \Big) \Big|_{z=-\infty}^{z=\frac{16}{3}} - 
           4 erf\Big( \frac{z}{\sqrt{2}} \Big) \Big|_{z=-\infty}^{z=0}  \\
        =& 4e^{18} erf\Big( \frac{\frac{16}{3}}{\sqrt{2}} \Big) - 4e^{18} erf\Big( \frac{-\infty}{\sqrt{2}} \Big) - 
           4 erf\Big( \frac{0}{\sqrt{2}} \Big) + 4 erf\Big( \frac{-\infty}{\sqrt{2}} \Big)  \\
        =& 4e^{18}erf\Big( \frac{8\sqrt{2}}{3} \Big) - 4e^{18}*(-1) - 4*0 + 4*(-1)  \\
        =& 4e^{18}erf\Big( \frac{8\sqrt{2}}{3} \Big) + 4e^{18} - 4  \\
        =& 4 \Big( e^{18} \Big[ erf\Big( \frac{8\sqrt{2}}{3} \Big) + 1 \Big] - 1 \Big)  \\
  \end{aligned}
\end{equation}

```{r}
P_0 <- 4 * (exp(18) * (erf(8*sqrt(2)/3) + 1) - 1)
```

Thus, $P_0 = 4 \Big( e^{18} \Big[ erf\Big( \frac{8\sqrt{2}}{3} \Big) + 1 \Big] - 1 \Big) \approx `r P_0`$.